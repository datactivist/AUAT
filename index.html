<!DOCTYPE html>
<html>
  <head>
    <title>Les essentiels de la data science</title>
    <meta charset="utf-8">
    <meta name="author" content="datactivi.st" />
    <link href="libs/remark-css/example.css" rel="stylesheet" />
    <script src="libs/htmlwidgets/htmlwidgets.js"></script>
    <script src="libs/blazy/blazy.min.js"></script>
    <script src="libs/pymjs/pym.v1.js"></script>
    <script src="libs/widgetframe-binding/widgetframe.js"></script>
    <link rel="stylesheet" href="assets/xaringan.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">





class: center, middle, title
background-image: url(./img/FraMauroDetailedMap.jpg)
background-size: cover
background-position: 50% 50%

# Les essentiels de la data science
## R : le couteau suisse des données

&lt;/BR&gt;
&lt;/BR&gt;
&lt;/BR&gt;

###  Joël Gombin, avec Endi Pons
&lt;img src="./img/Logo_DATACTIVIST_TW.png" height="100px" /&gt;

.right[.footnote[&lt;a href='https://commons.wikimedia.org/wiki/File:FraMauroDetailedMap.jpg'&gt;source&lt;/a&gt;]]


---
class: center, middle

Retrouvez les matériaux sur https://github.com/datactivist/AUAT

Ces slides en ligne : http://datactivi.st/AUAT

Pad collaboratif : https://frama.link/AUAT

---
class: center, middle

![](./img/by-sa.svg)

---
class: inverse, center, middle

## Faisons connaissance

https://frama.link/formationR

???
Recueillir les réponses, générer le dashboard et montrer et expliquer le code

---
class: inverse, center, middle
## Un exemple de workflow
### (OSM, PostGis, R, Leaflet)

test_osm.R

???

Montrer quelques capacités spatiales/GIS de R en quelques lignes

---
class: inverse, center, middle
## Un exemple de workflow
### (OSM, BAN, leaflet, tmap, modélisation)

https://joelgombin.github.io/makingof


---
## Vos habitudes de travail

- postgis ?
- QGIS ?
- R ?
- OSM ?
- ...

---
## Vos données

Essayez d'amener des données sur lesquelles vous souhaitez travailler


---
## Les objectifs (jour 1)

- Comprendre les possibilités offertes par R
- Comprendre le pipeline de données
- Savoir importer des données dans R
- Comprendre la notion de tidy data
- Savoir transformer ses données en tidy 
- (si on a le temps) introduction à sf

---
## Le data pipeline 

&lt;img src="./img/data-science.png" width="90%" style="display: block; margin: auto;" /&gt;

???

Présenter les étapes du data pipeline
Divers outils, workflows fragmentés
Variante de ce pipeline : celui de School of Data

---
## Le data pipeline 

&lt;img src="./img/pipeline.png" width="90%" style="display: block; margin: auto;" /&gt;

---
## One tool to rule them all

- R a comme avantage d'être un langage de programmation (= potentiel illimité) pensé exprès pour la manipulation des données (= usabilité, flexibilité)

- au fil du temps, devenu un "general purpose tool"

- permet d'interfacer de nombreux outils plus spécialisés

- une communauté très dynamique (free software)

- une syntaxe de plus en plus facile

- des progrès vers [des bouts de GUI](https://rstudio.github.io/rstudioaddins/)

---
## Se faire aider

* Des livres : 
  + [R for Data Science](http://r4ds.had.co.nz) de G. Grolemund et H. Wickham 
  + [Applied Spatial Data Analysis with R](http://gis.humboldt.edu/OLM/r/Spatial%20Analysis%20With%20R.pdf) de Bivand et al.
  + [An Introduction to R for Spatial Analysis and Mapping](https://www.amazon.com/Introduction-Spatial-Analysis-Mapping/dp/1446272958) de Brundson et Cumber
  + [R et espace](https://framabook.org/r-et-espace/), du groupe ElementR

* blogs : 
  + https://www.r-bloggers.com 
  + https://quanti.hypotheses.org/
  + https://politbistro.hypotheses.org
  + https://neocarto.hypotheses.org/
  + http://rgeomatic.hypotheses.org/
  + http://elementr.hypotheses.org/

---
## Se faire aider


* des listes de diffusion thématiques (ex : [la liste quanti](mailto:quanti@groupes.renater.fr), semin-r@mnhn.fr, r-soc@groupes.renater.fr), des forums (http://forums.cirad.fr/logiciel-R/)

* un site de Q/R communautaires : http://stackoverflow.com/questions/tagged/r

* twitter avec le hashtag [#Rstats](https://twitter.com/search?q=%23rstats)

* les [meetup R](https://www.meetup.com/fr-FR/rparis/)
   
* les [cheatsheets de Rstudio](https://www.rstudio.com/resources/cheatsheets/) 

---
## Prise en main de Rstudio

- raccourci pour exécuter une ligne de code : ctrl + entrée, pomme + entrée pour Mac

---
## Scripts, litterate programming, reproducible research

- toujours travailler dans le cadre d'un "projet"

- ne jamais travailler dans la console

- écrire des scripts

- mieux : mêler texte et code au moyen de [fichiers Rmd](http://rmarkdown.rstudio.com/)

- versionage (git)

- notebook

- commentez ! (avec le #)


```r
# ceci est un commentaire
```



---
## Installation du tidyverse

* Le `tidyverse` (ou hadleyverse) opérationnalise le workflow. Suite de packages pensés pour fonctionner ensemble

* La "glue" de ce package : le "pipe" `%&gt;%` (Ctrl/Cmd + shift + M)

* Pour installer le tidyverse, entrez dans la console : `install.packages("tidyverse")` (ou via Rstudio)

* `library(tidyverse)` =&gt; charge le package

---
class: inverse, center, middle

# Importer des données

---
## En GUI ou en CLI

- bouton "Import dataset"

- en CLI : package `readr` pour le CSV, `haven` pour SPSS / SAS / Stata, `readxl` pour le XLS(X), `rio` pour (presque) tout le reste

*Et vous, quel(s) format(s) de données utilisez-vous habituellement ?*

---
## Importez votre premier jeu de données !

- chargement de package : `library(readr)` (ou `library(tidyverse)`)

- Attention à l'assignation : 

  `monjeudedonnees &lt;- read_csv("monfichier.csv")` 

- Importons un jeu de données électoral : les résultats par commune du premier tour de l'élection présidentielle. Source : https://github.com/datactivist/presidentielle2017 (préparées avec https://github.com/joelgombin/LireMinInterieur)

---
## Importez votre premier jeu de données !


```r
suppressPackageStartupMessages(library(tidyverse))
pres2017T1_communes &lt;- read_csv("./data/Presidentielle_2017_Resultats_Communes_T1_clean.csv")
```

```
## Parsed with column specification:
## cols(
##   .default = col_double(),
##   CodeInsee = col_character(),
##   CodeDepartement = col_character(),
##   Département = col_character(),
##   Commune = col_character(),
##   Inscrits = col_integer(),
##   Abstentions = col_integer(),
##   Votants = col_integer(),
##   Blancs = col_integer(),
##   Nuls = col_integer(),
##   Exprimés = col_integer(),
##   `LE PEN` = col_integer(),
##   MÉLENCHON = col_integer(),
##   MACRON = col_integer(),
##   FILLON = col_integer(),
##   LASSALLE = col_integer(),
##   `DUPONT-AIGNAN` = col_integer(),
##   HAMON = col_integer(),
##   ASSELINEAU = col_integer(),
##   POUTOU = col_integer(),
##   ARTHAUD = col_integer()
##   # ... with 1 more columns
## )
```

```
## See spec(...) for full column specifications.
```

## Importez votre premier jeu de données !

Si besoin, ajuster l'import au moyen des arguments `col_types`, `locale` ou encore `na`


```r
pres2017T1_communes &lt;- read_csv("./data/Presidentielle_2017_Resultats_Communes_T1_clean.csv",
                       na = "",
                       col_types = cols(
  .default = col_double(),
  CodeInsee = col_character(),
  CodeDepartement = col_character(),
  Département = col_character(),
  Commune = col_character(),
  Inscrits = col_integer(),
  Abstentions = col_integer(),
  Votants = col_integer(),
  Blancs = col_integer(),
  Nuls = col_integer(),
  Exprimés = col_integer(),
  `LE PEN` = col_integer(),
  MÉLENCHON = col_integer(),
  MACRON = col_integer(),
  FILLON = col_integer(),
  LASSALLE = col_integer(),
  `DUPONT-AIGNAN` = col_integer(),
  HAMON = col_integer(),
  ASSELINEAU = col_integer(),
  POUTOU = col_integer(),
  ARTHAUD = col_integer(),
  CHEMINADE = col_integer()
  )
)
```

???

Expliquer les types de variable

---
## La notion de fonction


```r
sum(1, 2, 3)
```

```
## [1] 6
```

```r
a &lt;- sum(1, 2, 3)

a
```

```
## [1] 6
```


---
class: inverse, center, middle
# Le tidyverse 

---
## La notion de tidy data

&gt; “Happy families are all alike; every unhappy family is unhappy in its own way.” – Tolstoï

&gt; “Tidy datasets are all alike, but every messy dataset is messy in its own way.” – Hadley Wickham

- À chaque variable sa propre colonne

- À chaque observation sa propre ligne

- À chaque valeur sa propre cellule

---
## La notion de tidy data

&lt;img src="./img/tidy-1.png" width="90%" style="display: block; margin: auto;" /&gt;

---
## La notion de tidy data

- À chaque observation sa propre ligne

- À chaque variable sa colonne

- À chaque valeur sa propre cellule &gt; 1 jeu de données par table, dite “tibble”

---
## Un exemple de untidy data

https://www.data.gouv.fr/fr/datasets/election-presidentielle-des-23-avril-et-7-mai-2017-resultats-definitifs-du-1er-tour-par-communes/

---
## Préparer des tidy data

- `dplyr` et `tidyr`

- le pipe : `%&gt;%` (Ctrl/Cmd + shift + M)

- les verbes : 
  + `filter` (et `slice`)
  + `arrange`
  + `select` (et `rename`)
  + `distinct`
  + `mutate` 
  + `group_by` 
  + `summarise`
  + `sample_n` / `sample_frac`

- `stringr` peut utilement accompagner (manipulation de chaînes de caractères)


---
## Pivoter

`gather` et `spread`

&lt;img src="http://r4ds.had.co.nz/images/tidy-9.png" width="90%" style="display: block; margin: auto;" /&gt;

---
## Pivoter


```r
pres2017T1_communes_long &lt;- pres2017T1_communes %&gt;% 
  select(- contains("_ins")) %&gt;%
  select(- contains("_exp")) %&gt;%   
  gather(candidat, voix, `LE PEN`:CHEMINADE)

pres2017T1_communes_long
```

```
## # A tibble: 390,456 x 15
##    CodeInsee CodeDepartement Département                 Commune Inscrits
##        &lt;chr&gt;           &lt;chr&gt;       &lt;chr&gt;                   &lt;chr&gt;    &lt;int&gt;
##  1     01001              01         Ain L'Abergement-Clémenciat      598
##  2     01002              01         Ain   L'Abergement-de-Varey      209
##  3     01004              01         Ain       Ambérieu-en-Bugey     8586
##  4     01005              01         Ain     Ambérieux-en-Dombes     1172
##  5     01006              01         Ain                 Ambléon       99
##  6     01007              01         Ain                Ambronay     1880
##  7     01008              01         Ain                Ambutrix      581
##  8     01009              01         Ain        Andert-et-Condon      254
##  9     01010              01         Ain               Anglefort      738
## 10     01011              01         Ain                Apremont      275
## # ... with 390,446 more rows, and 10 more variables: Abstentions &lt;int&gt;,
## #   Votants &lt;int&gt;, Blancs &lt;int&gt;, Blancs_vot &lt;dbl&gt;, Nuls &lt;int&gt;,
## #   Nuls_vot &lt;dbl&gt;, Exprimés &lt;int&gt;, Exprimés_vot &lt;dbl&gt;, candidat &lt;chr&gt;,
## #   voix &lt;int&gt;
```

---
## Modifier


```r
pres2017T1_communes_long &lt;- pres2017T1_communes_long %&gt;% 
  mutate(ins = voix / Inscrits * 100) %&gt;% 
  mutate(exp = voix / Exprimés * 100) %&gt;%
  print
```

```
## # A tibble: 390,456 x 17
##    CodeInsee CodeDepartement Département                 Commune Inscrits
##        &lt;chr&gt;           &lt;chr&gt;       &lt;chr&gt;                   &lt;chr&gt;    &lt;int&gt;
##  1     01001              01         Ain L'Abergement-Clémenciat      598
##  2     01002              01         Ain   L'Abergement-de-Varey      209
##  3     01004              01         Ain       Ambérieu-en-Bugey     8586
##  4     01005              01         Ain     Ambérieux-en-Dombes     1172
##  5     01006              01         Ain                 Ambléon       99
##  6     01007              01         Ain                Ambronay     1880
##  7     01008              01         Ain                Ambutrix      581
##  8     01009              01         Ain        Andert-et-Condon      254
##  9     01010              01         Ain               Anglefort      738
## 10     01011              01         Ain                Apremont      275
## # ... with 390,446 more rows, and 12 more variables: Abstentions &lt;int&gt;,
## #   Votants &lt;int&gt;, Blancs &lt;int&gt;, Blancs_vot &lt;dbl&gt;, Nuls &lt;int&gt;,
## #   Nuls_vot &lt;dbl&gt;, Exprimés &lt;int&gt;, Exprimés_vot &lt;dbl&gt;, candidat &lt;chr&gt;,
## #   voix &lt;int&gt;, ins &lt;dbl&gt;, exp &lt;dbl&gt;
```

---
## Pivoter


```r
pres2017T1_communes_long %&gt;% 
  gather(metrique, valeur, voix:exp) %&gt;% 
  glimpse
```

```
## Observations: 1,171,368
## Variables: 16
## $ CodeInsee       &lt;chr&gt; "01001", "01002", "01004", "01005", "01006", "...
## $ CodeDepartement &lt;chr&gt; "01", "01", "01", "01", "01", "01", "01", "01"...
## $ Département     &lt;chr&gt; "Ain", "Ain", "Ain", "Ain", "Ain", "Ain", "Ain...
## $ Commune         &lt;chr&gt; "L'Abergement-Clémenciat", "L'Abergement-de-Va...
## $ Inscrits        &lt;int&gt; 598, 209, 8586, 1172, 99, 1880, 581, 254, 738,...
## $ Abstentions     &lt;int&gt; 92, 25, 1962, 215, 20, 268, 91, 41, 136, 43, 5...
## $ Votants         &lt;int&gt; 506, 184, 6624, 957, 79, 1612, 490, 213, 602, ...
## $ Blancs          &lt;int&gt; 2, 6, 114, 21, 2, 53, 12, 1, 2, 6, 0, 2, 33, 1...
## $ Blancs_vot      &lt;dbl&gt; 0.3952569, 3.2608696, 1.7210145, 2.1943574, 2....
## $ Nuls            &lt;int&gt; 9, 2, 58, 3, 0, 11, 5, 3, 11, 2, 7, 0, 12, 8, ...
## $ Nuls_vot        &lt;dbl&gt; 1.7786561, 1.0869565, 0.8756039, 0.3134796, 0....
## $ Exprimés        &lt;int&gt; 495, 176, 6452, 933, 77, 1548, 473, 209, 589, ...
## $ Exprimés_vot    &lt;dbl&gt; 97.82609, 95.65217, 97.40338, 97.49216, 97.468...
## $ candidat        &lt;chr&gt; "LE PEN", "LE PEN", "LE PEN", "LE PEN", "LE PE...
## $ metrique        &lt;chr&gt; "voix", "voix", "voix", "voix", "voix", "voix"...
## $ valeur          &lt;dbl&gt; 126, 48, 1667, 306, 18, 458, 135, 40, 207, 64,...
```

---
## Pivoter


```r
pres2017T1_communes_long %&gt;% 
  gather(metrique, valeur, voix:exp) %&gt;% 
  unite(variable, candidat, metrique, sep = "_") %&gt;% 
  glimpse
```

```
## Observations: 1,171,368
## Variables: 15
## $ CodeInsee       &lt;chr&gt; "01001", "01002", "01004", "01005", "01006", "...
## $ CodeDepartement &lt;chr&gt; "01", "01", "01", "01", "01", "01", "01", "01"...
## $ Département     &lt;chr&gt; "Ain", "Ain", "Ain", "Ain", "Ain", "Ain", "Ain...
## $ Commune         &lt;chr&gt; "L'Abergement-Clémenciat", "L'Abergement-de-Va...
## $ Inscrits        &lt;int&gt; 598, 209, 8586, 1172, 99, 1880, 581, 254, 738,...
## $ Abstentions     &lt;int&gt; 92, 25, 1962, 215, 20, 268, 91, 41, 136, 43, 5...
## $ Votants         &lt;int&gt; 506, 184, 6624, 957, 79, 1612, 490, 213, 602, ...
## $ Blancs          &lt;int&gt; 2, 6, 114, 21, 2, 53, 12, 1, 2, 6, 0, 2, 33, 1...
## $ Blancs_vot      &lt;dbl&gt; 0.3952569, 3.2608696, 1.7210145, 2.1943574, 2....
## $ Nuls            &lt;int&gt; 9, 2, 58, 3, 0, 11, 5, 3, 11, 2, 7, 0, 12, 8, ...
## $ Nuls_vot        &lt;dbl&gt; 1.7786561, 1.0869565, 0.8756039, 0.3134796, 0....
## $ Exprimés        &lt;int&gt; 495, 176, 6452, 933, 77, 1548, 473, 209, 589, ...
## $ Exprimés_vot    &lt;dbl&gt; 97.82609, 95.65217, 97.40338, 97.49216, 97.468...
## $ variable        &lt;chr&gt; "LE PEN_voix", "LE PEN_voix", "LE PEN_voix", "...
## $ valeur          &lt;dbl&gt; 126, 48, 1667, 306, 18, 458, 135, 40, 207, 64,...
```

---
## Pivoter


```r
pres2017T1_communes_long %&gt;% 
  gather(metrique, valeur, voix:exp) %&gt;% 
  unite(variable, candidat, metrique, sep = "_") %&gt;% 
  spread(variable, valeur) %&gt;% 
  glimpse
```

```
## Observations: 35,496
## Variables: 46
## $ CodeInsee            &lt;chr&gt; "01001", "01002", "01004", "01005", "0100...
## $ CodeDepartement      &lt;chr&gt; "01", "01", "01", "01", "01", "01", "01",...
## $ Département          &lt;chr&gt; "Ain", "Ain", "Ain", "Ain", "Ain", "Ain",...
## $ Commune              &lt;chr&gt; "L'Abergement-Clémenciat", "L'Abergement-...
## $ Inscrits             &lt;int&gt; 598, 209, 8586, 1172, 99, 1880, 581, 254,...
## $ Abstentions          &lt;int&gt; 92, 25, 1962, 215, 20, 268, 91, 41, 136, ...
## $ Votants              &lt;int&gt; 506, 184, 6624, 957, 79, 1612, 490, 213, ...
## $ Blancs               &lt;int&gt; 2, 6, 114, 21, 2, 53, 12, 1, 2, 6, 0, 2, ...
## $ Blancs_vot           &lt;dbl&gt; 0.3952569, 3.2608696, 1.7210145, 2.194357...
## $ Nuls                 &lt;int&gt; 9, 2, 58, 3, 0, 11, 5, 3, 11, 2, 7, 0, 12...
## $ Nuls_vot             &lt;dbl&gt; 1.7786561, 1.0869565, 0.8756039, 0.313479...
## $ Exprimés             &lt;int&gt; 495, 176, 6452, 933, 77, 1548, 473, 209, ...
## $ Exprimés_vot         &lt;dbl&gt; 97.82609, 95.65217, 97.40338, 97.49216, 9...
## $ ARTHAUD_exp          &lt;dbl&gt; 0.8080808, 1.1363636, 0.6199628, 0.535905...
## $ ARTHAUD_ins          &lt;dbl&gt; 0.6688963, 0.9569378, 0.4658747, 0.426621...
## $ ARTHAUD_voix         &lt;dbl&gt; 4, 2, 40, 5, 1, 9, 3, 0, 3, 4, 2, 2, 9, 3...
## $ ASSELINEAU_exp       &lt;dbl&gt; 1.2121212, 0.5681818, 1.1004340, 1.071811...
## $ ASSELINEAU_ins       &lt;dbl&gt; 1.0033445, 0.4784689, 0.8269276, 0.853242...
## $ ASSELINEAU_voix      &lt;dbl&gt; 6, 1, 71, 10, 0, 11, 2, 6, 10, 1, 0, 2, 2...
## $ CHEMINADE_exp        &lt;dbl&gt; 0.40404040, 0.00000000, 0.07749535, 0.000...
## $ CHEMINADE_ins        &lt;dbl&gt; 0.33444816, 0.00000000, 0.05823433, 0.000...
## $ CHEMINADE_voix       &lt;dbl&gt; 2, 0, 5, 0, 0, 1, 3, 0, 1, 0, 1, 0, 2, 2,...
## $ `DUPONT-AIGNAN_exp`  &lt;dbl&gt; 6.868687, 3.409091, 5.362678, 4.823151, 5...
## $ `DUPONT-AIGNAN_ins`  &lt;dbl&gt; 5.685619, 2.870813, 4.029816, 3.839590, 4...
## $ `DUPONT-AIGNAN_voix` &lt;dbl&gt; 34, 6, 346, 45, 4, 80, 28, 6, 33, 9, 10, ...
## $ FILLON_exp           &lt;dbl&gt; 22.22222, 19.31818, 16.80099, 21.11468, 1...
## $ FILLON_ins           &lt;dbl&gt; 18.394649, 16.267943, 12.625204, 16.80887...
## $ FILLON_voix          &lt;dbl&gt; 110, 34, 1084, 197, 14, 233, 84, 44, 83, ...
## $ HAMON_exp            &lt;dbl&gt; 5.8585859, 7.3863636, 5.3316801, 3.965702...
## $ HAMON_ins            &lt;dbl&gt; 4.8494983, 6.2200957, 4.0065222, 3.156996...
## $ HAMON_voix           &lt;dbl&gt; 29, 13, 344, 37, 3, 82, 23, 8, 20, 13, 10...
## $ LASSALLE_exp         &lt;dbl&gt; 0.4040404, 0.0000000, 0.9299442, 0.643086...
## $ LASSALLE_ins         &lt;dbl&gt; 0.3344482, 0.0000000, 0.6988120, 0.511945...
## $ LASSALLE_voix        &lt;dbl&gt; 2, 0, 60, 6, 1, 13, 3, 8, 14, 4, 2, 0, 21...
## $ `LE PEN_exp`         &lt;dbl&gt; 25.45455, 27.27273, 25.83695, 32.79743, 2...
## $ `LE PEN_ins`         &lt;dbl&gt; 21.07023, 22.96651, 19.41533, 26.10922, 1...
## $ `LE PEN_voix`        &lt;dbl&gt; 126, 48, 1667, 306, 18, 458, 135, 40, 207...
## $ MACRON_exp           &lt;dbl&gt; 24.040404, 21.022727, 20.644761, 20.47159...
## $ MACRON_ins           &lt;dbl&gt; 19.899666, 17.703349, 15.513627, 16.29692...
## $ MACRON_voix          &lt;dbl&gt; 119, 37, 1332, 191, 15, 348, 95, 55, 110,...
## $ MÉLENCHON_exp        &lt;dbl&gt; 11.91919, 18.75000, 21.88469, 13.50482, 2...
## $ MÉLENCHON_ins        &lt;dbl&gt; 9.866221, 15.789474, 16.445376, 10.750853...
## $ MÉLENCHON_voix       &lt;dbl&gt; 59, 33, 1412, 126, 19, 296, 89, 39, 103, ...
## $ POUTOU_exp           &lt;dbl&gt; 0.8080808, 1.1363636, 1.4104154, 1.071811...
## $ POUTOU_ins           &lt;dbl&gt; 0.6688963, 0.9569378, 1.0598649, 0.853242...
## $ POUTOU_voix          &lt;dbl&gt; 4, 2, 91, 10, 2, 17, 8, 3, 5, 4, 2, 2, 15...
```

---

class: inverse, center, middle

## À vous !

### Choisissez un jeu de données à importer et nettoyer


---
## Le data pipeline 

&lt;img src="./img/pipeline.png" width="90%" style="display: block; margin: auto;" /&gt;



---
class: center, middle, inverse

## Évaluation

## https://frama.link/eval-auat-1

---
class: center, middle, title
background-image: url(./img/FraMauroDetailedMap.jpg)
background-size: cover
background-position: 50% 50%

# Analyser ses données
## R : le couteau suisse des données

&lt;/BR&gt;
&lt;/BR&gt;
&lt;/BR&gt;

###  Joël Gombin, avec Endi Pons
&lt;img src="./img/Logo_DATACTIVIST_TW.png" height="100px" /&gt;

.right[.footnote[&lt;a href='https://commons.wikimedia.org/wiki/File:FraMauroDetailedMap.jpg'&gt;source&lt;/a&gt;]]

---
## Objectifs (jour 2)

- Solidifier les acquis d'hier

- Boîte à outils : le tidyverse (suite)

- Les tidydata géographiques

- Analyse uni- et bi-variées

- Analyse multivariée (AGD)


---
## Exercices

- Importer des données en CSV

- sélectionner certaines lignes en fonction d'une condition logique

- ajouter une nouvelle variable

- agréger/résumer les données par groupe

- trier le résultat

- pivoter des données

---
## Recoder des données

- `recode`

- `case_when`

---
## Recoder des données


```r
suppressPackageStartupMessages(library(tidyverse))
elections &lt;- read_csv("data/Presidentielle_2017_Resultats_Communes_T1_clean.csv")
```

```
## Parsed with column specification:
## cols(
##   .default = col_double(),
##   CodeInsee = col_character(),
##   CodeDepartement = col_character(),
##   Département = col_character(),
##   Commune = col_character(),
##   Inscrits = col_integer(),
##   Abstentions = col_integer(),
##   Votants = col_integer(),
##   Blancs = col_integer(),
##   Nuls = col_integer(),
##   Exprimés = col_integer(),
##   `LE PEN` = col_integer(),
##   MÉLENCHON = col_integer(),
##   MACRON = col_integer(),
##   FILLON = col_integer(),
##   LASSALLE = col_integer(),
##   `DUPONT-AIGNAN` = col_integer(),
##   HAMON = col_integer(),
##   ASSELINEAU = col_integer(),
##   POUTOU = col_integer(),
##   ARTHAUD = col_integer()
##   # ... with 1 more columns
## )
```

```
## See spec(...) for full column specifications.
```

---
## Recoder des données


```r
elections %&gt;% 
  mutate(region = case_when(
  CodeDepartement %in% c("75", "77", "78", "91", "92", "93", "94", "95") ~ "Ile-de-France",
  TRUE ~ "Province")) %&gt;% 
  glimpse
```

```
## Observations: 35,496
## Variables: 52
## $ CodeInsee           &lt;chr&gt; "01001", "01002", "01004", "01005", "01006...
## $ CodeDepartement     &lt;chr&gt; "01", "01", "01", "01", "01", "01", "01", ...
## $ Département         &lt;chr&gt; "Ain", "Ain", "Ain", "Ain", "Ain", "Ain", ...
## $ Commune             &lt;chr&gt; "L'Abergement-Clémenciat", "L'Abergement-d...
## $ Inscrits            &lt;int&gt; 598, 209, 8586, 1172, 99, 1880, 581, 254, ...
## $ Abstentions         &lt;int&gt; 92, 25, 1962, 215, 20, 268, 91, 41, 136, 4...
## $ Abstentions_ins     &lt;dbl&gt; 15.38462, 11.96172, 22.85115, 18.34471, 20...
## $ Votants             &lt;int&gt; 506, 184, 6624, 957, 79, 1612, 490, 213, 6...
## $ Votants_ins         &lt;dbl&gt; 84.61538, 88.03828, 77.14885, 81.65529, 79...
## $ Blancs              &lt;int&gt; 2, 6, 114, 21, 2, 53, 12, 1, 2, 6, 0, 2, 3...
## $ Blancs_ins          &lt;dbl&gt; 0.3344482, 2.8708134, 1.3277428, 1.7918089...
## $ Blancs_vot          &lt;dbl&gt; 0.3952569, 3.2608696, 1.7210145, 2.1943574...
## $ Nuls                &lt;int&gt; 9, 2, 58, 3, 0, 11, 5, 3, 11, 2, 7, 0, 12,...
## $ Nuls_ins            &lt;dbl&gt; 1.5050167, 0.9569378, 0.6755183, 0.2559727...
## $ Nuls_vot            &lt;dbl&gt; 1.7786561, 1.0869565, 0.8756039, 0.3134796...
## $ Exprimés            &lt;int&gt; 495, 176, 6452, 933, 77, 1548, 473, 209, 5...
## $ Exprimés_ins        &lt;dbl&gt; 82.77592, 84.21053, 75.14559, 79.60751, 77...
## $ Exprimés_vot        &lt;dbl&gt; 97.82609, 95.65217, 97.40338, 97.49216, 97...
## $ `LE PEN`            &lt;int&gt; 126, 48, 1667, 306, 18, 458, 135, 40, 207,...
## $ MÉLENCHON           &lt;int&gt; 59, 33, 1412, 126, 19, 296, 89, 39, 103, 3...
## $ MACRON              &lt;int&gt; 119, 37, 1332, 191, 15, 348, 95, 55, 110, ...
## $ FILLON              &lt;int&gt; 110, 34, 1084, 197, 14, 233, 84, 44, 83, 4...
## $ LASSALLE            &lt;int&gt; 2, 0, 60, 6, 1, 13, 3, 8, 14, 4, 2, 0, 21,...
## $ `DUPONT-AIGNAN`     &lt;int&gt; 34, 6, 346, 45, 4, 80, 28, 6, 33, 9, 10, 3...
## $ HAMON               &lt;int&gt; 29, 13, 344, 37, 3, 82, 23, 8, 20, 13, 10,...
## $ ASSELINEAU          &lt;int&gt; 6, 1, 71, 10, 0, 11, 2, 6, 10, 1, 0, 2, 23...
## $ POUTOU              &lt;int&gt; 4, 2, 91, 10, 2, 17, 8, 3, 5, 4, 2, 2, 15,...
## $ ARTHAUD             &lt;int&gt; 4, 2, 40, 5, 1, 9, 3, 0, 3, 4, 2, 2, 9, 3,...
## $ CHEMINADE           &lt;int&gt; 2, 0, 5, 0, 0, 1, 3, 0, 1, 0, 1, 0, 2, 2, ...
## $ `LE PEN_ins`        &lt;dbl&gt; 21.07023, 22.96651, 19.41533, 26.10922, 18...
## $ MÉLENCHON_ins       &lt;dbl&gt; 9.866221, 15.789474, 16.445376, 10.750853,...
## $ MACRON_ins          &lt;dbl&gt; 19.899666, 17.703349, 15.513627, 16.296928...
## $ FILLON_ins          &lt;dbl&gt; 18.394649, 16.267943, 12.625204, 16.808874...
## $ LASSALLE_ins        &lt;dbl&gt; 0.3344482, 0.0000000, 0.6988120, 0.5119454...
## $ `DUPONT-AIGNAN_ins` &lt;dbl&gt; 5.685619, 2.870813, 4.029816, 3.839590, 4....
## $ HAMON_ins           &lt;dbl&gt; 4.8494983, 6.2200957, 4.0065222, 3.1569966...
## $ ASSELINEAU_ins      &lt;dbl&gt; 1.0033445, 0.4784689, 0.8269276, 0.8532423...
## $ POUTOU_ins          &lt;dbl&gt; 0.6688963, 0.9569378, 1.0598649, 0.8532423...
## $ ARTHAUD_ins         &lt;dbl&gt; 0.6688963, 0.9569378, 0.4658747, 0.4266212...
## $ CHEMINADE_ins       &lt;dbl&gt; 0.33444816, 0.00000000, 0.05823433, 0.0000...
## $ `LE PEN_exp`        &lt;dbl&gt; 25.45455, 27.27273, 25.83695, 32.79743, 23...
## $ MÉLENCHON_exp       &lt;dbl&gt; 11.91919, 18.75000, 21.88469, 13.50482, 24...
## $ MACRON_exp          &lt;dbl&gt; 24.040404, 21.022727, 20.644761, 20.471597...
## $ FILLON_exp          &lt;dbl&gt; 22.22222, 19.31818, 16.80099, 21.11468, 18...
## $ LASSALLE_exp        &lt;dbl&gt; 0.4040404, 0.0000000, 0.9299442, 0.6430868...
## $ `DUPONT-AIGNAN_exp` &lt;dbl&gt; 6.868687, 3.409091, 5.362678, 4.823151, 5....
## $ HAMON_exp           &lt;dbl&gt; 5.8585859, 7.3863636, 5.3316801, 3.9657020...
## $ ASSELINEAU_exp      &lt;dbl&gt; 1.2121212, 0.5681818, 1.1004340, 1.0718114...
## $ POUTOU_exp          &lt;dbl&gt; 0.8080808, 1.1363636, 1.4104154, 1.0718114...
## $ ARTHAUD_exp         &lt;dbl&gt; 0.8080808, 1.1363636, 0.6199628, 0.5359057...
## $ CHEMINADE_exp       &lt;dbl&gt; 0.40404040, 0.00000000, 0.07749535, 0.0000...
## $ region              &lt;chr&gt; "Province", "Province", "Province", "Provi...
```

---
## Fusionner des jeux de données

- primary keys et foreign keys

- `left_join`
- `right_join`
- `full_join`
- `inner_join`
- `semi_join`
- `anti_join`

---
## Left join

![](http://r4ds.had.co.nz/diagrams/join-setup.png)

---
## Left join

![](http://r4ds.had.co.nz/diagrams/join-setup2.png)

---
## Inner join

![](http://r4ds.had.co.nz/diagrams/join-inner.png)

---
## Outer join

.reduite[.center[![](http://r4ds.had.co.nz/diagrams/join-outer.png)]]

---
## Semi join

![](http://r4ds.had.co.nz/diagrams/join-semi.png)

---
## Anti join

![](http://r4ds.had.co.nz/diagrams/join-anti.png)

---
## Exemple

(source : https://www.insee.fr/fr/information/2114596)


```r
library(readxl)
ZE2010 &lt;- read_xls("./data/ZE2010 au 01-01-2017.xls", sheet = "Composition_communale", skip = 5)

elections &lt;- elections %&gt;% 
  left_join(ZE2010, by = c("CodeInsee" = "CODGEO")) %&gt;% 
  glimpse()
```

```
## Observations: 35,496
## Variables: 56
## $ CodeInsee           &lt;chr&gt; "01001", "01002", "01004", "01005", "01006...
## $ CodeDepartement     &lt;chr&gt; "01", "01", "01", "01", "01", "01", "01", ...
## $ Département         &lt;chr&gt; "Ain", "Ain", "Ain", "Ain", "Ain", "Ain", ...
## $ Commune             &lt;chr&gt; "L'Abergement-Clémenciat", "L'Abergement-d...
## $ Inscrits            &lt;int&gt; 598, 209, 8586, 1172, 99, 1880, 581, 254, ...
## $ Abstentions         &lt;int&gt; 92, 25, 1962, 215, 20, 268, 91, 41, 136, 4...
## $ Abstentions_ins     &lt;dbl&gt; 15.38462, 11.96172, 22.85115, 18.34471, 20...
## $ Votants             &lt;int&gt; 506, 184, 6624, 957, 79, 1612, 490, 213, 6...
## $ Votants_ins         &lt;dbl&gt; 84.61538, 88.03828, 77.14885, 81.65529, 79...
## $ Blancs              &lt;int&gt; 2, 6, 114, 21, 2, 53, 12, 1, 2, 6, 0, 2, 3...
## $ Blancs_ins          &lt;dbl&gt; 0.3344482, 2.8708134, 1.3277428, 1.7918089...
## $ Blancs_vot          &lt;dbl&gt; 0.3952569, 3.2608696, 1.7210145, 2.1943574...
## $ Nuls                &lt;int&gt; 9, 2, 58, 3, 0, 11, 5, 3, 11, 2, 7, 0, 12,...
## $ Nuls_ins            &lt;dbl&gt; 1.5050167, 0.9569378, 0.6755183, 0.2559727...
## $ Nuls_vot            &lt;dbl&gt; 1.7786561, 1.0869565, 0.8756039, 0.3134796...
## $ Exprimés            &lt;int&gt; 495, 176, 6452, 933, 77, 1548, 473, 209, 5...
## $ Exprimés_ins        &lt;dbl&gt; 82.77592, 84.21053, 75.14559, 79.60751, 77...
## $ Exprimés_vot        &lt;dbl&gt; 97.82609, 95.65217, 97.40338, 97.49216, 97...
## $ `LE PEN`            &lt;int&gt; 126, 48, 1667, 306, 18, 458, 135, 40, 207,...
## $ MÉLENCHON           &lt;int&gt; 59, 33, 1412, 126, 19, 296, 89, 39, 103, 3...
## $ MACRON              &lt;int&gt; 119, 37, 1332, 191, 15, 348, 95, 55, 110, ...
## $ FILLON              &lt;int&gt; 110, 34, 1084, 197, 14, 233, 84, 44, 83, 4...
## $ LASSALLE            &lt;int&gt; 2, 0, 60, 6, 1, 13, 3, 8, 14, 4, 2, 0, 21,...
## $ `DUPONT-AIGNAN`     &lt;int&gt; 34, 6, 346, 45, 4, 80, 28, 6, 33, 9, 10, 3...
## $ HAMON               &lt;int&gt; 29, 13, 344, 37, 3, 82, 23, 8, 20, 13, 10,...
## $ ASSELINEAU          &lt;int&gt; 6, 1, 71, 10, 0, 11, 2, 6, 10, 1, 0, 2, 23...
## $ POUTOU              &lt;int&gt; 4, 2, 91, 10, 2, 17, 8, 3, 5, 4, 2, 2, 15,...
## $ ARTHAUD             &lt;int&gt; 4, 2, 40, 5, 1, 9, 3, 0, 3, 4, 2, 2, 9, 3,...
## $ CHEMINADE           &lt;int&gt; 2, 0, 5, 0, 0, 1, 3, 0, 1, 0, 1, 0, 2, 2, ...
## $ `LE PEN_ins`        &lt;dbl&gt; 21.07023, 22.96651, 19.41533, 26.10922, 18...
## $ MÉLENCHON_ins       &lt;dbl&gt; 9.866221, 15.789474, 16.445376, 10.750853,...
## $ MACRON_ins          &lt;dbl&gt; 19.899666, 17.703349, 15.513627, 16.296928...
## $ FILLON_ins          &lt;dbl&gt; 18.394649, 16.267943, 12.625204, 16.808874...
## $ LASSALLE_ins        &lt;dbl&gt; 0.3344482, 0.0000000, 0.6988120, 0.5119454...
## $ `DUPONT-AIGNAN_ins` &lt;dbl&gt; 5.685619, 2.870813, 4.029816, 3.839590, 4....
## $ HAMON_ins           &lt;dbl&gt; 4.8494983, 6.2200957, 4.0065222, 3.1569966...
## $ ASSELINEAU_ins      &lt;dbl&gt; 1.0033445, 0.4784689, 0.8269276, 0.8532423...
## $ POUTOU_ins          &lt;dbl&gt; 0.6688963, 0.9569378, 1.0598649, 0.8532423...
## $ ARTHAUD_ins         &lt;dbl&gt; 0.6688963, 0.9569378, 0.4658747, 0.4266212...
## $ CHEMINADE_ins       &lt;dbl&gt; 0.33444816, 0.00000000, 0.05823433, 0.0000...
## $ `LE PEN_exp`        &lt;dbl&gt; 25.45455, 27.27273, 25.83695, 32.79743, 23...
## $ MÉLENCHON_exp       &lt;dbl&gt; 11.91919, 18.75000, 21.88469, 13.50482, 24...
## $ MACRON_exp          &lt;dbl&gt; 24.040404, 21.022727, 20.644761, 20.471597...
## $ FILLON_exp          &lt;dbl&gt; 22.22222, 19.31818, 16.80099, 21.11468, 18...
## $ LASSALLE_exp        &lt;dbl&gt; 0.4040404, 0.0000000, 0.9299442, 0.6430868...
## $ `DUPONT-AIGNAN_exp` &lt;dbl&gt; 6.868687, 3.409091, 5.362678, 4.823151, 5....
## $ HAMON_exp           &lt;dbl&gt; 5.8585859, 7.3863636, 5.3316801, 3.9657020...
## $ ASSELINEAU_exp      &lt;dbl&gt; 1.2121212, 0.5681818, 1.1004340, 1.0718114...
## $ POUTOU_exp          &lt;dbl&gt; 0.8080808, 1.1363636, 1.4104154, 1.0718114...
## $ ARTHAUD_exp         &lt;dbl&gt; 0.8080808, 1.1363636, 0.6199628, 0.5359057...
## $ CHEMINADE_exp       &lt;dbl&gt; 0.40404040, 0.00000000, 0.07749535, 0.0000...
## $ LIBGEO              &lt;chr&gt; "L'Abergement-Clémenciat", "L'Abergement-d...
## $ ZE2010              &lt;chr&gt; "8213", "8201", "8201", "8213", "8216", "8...
## $ LIBZE2010           &lt;chr&gt; "Villefranche-sur-Saône", "Ambérieu-en-Bug...
## $ DEP                 &lt;chr&gt; "01", "01", "01", "01", "01", "01", "01", ...
## $ REG                 &lt;chr&gt; "84", "84", "84", "84", "84", "84", "84", ...
```

---
## Exemple


```r
elections %&gt;% 
  group_by(ZE2010) %&gt;% 
  summarise_at(vars(Inscrits, Abstentions, Votants, Blancs, Nuls, Exprimés, `LE PEN`:CHEMINADE), funs(sum(.)))
```

```
## # A tibble: 305 x 18
##    ZE2010 Inscrits Abstentions Votants Blancs  Nuls Exprimés `LE PEN`
##     &lt;chr&gt;    &lt;int&gt;       &lt;int&gt;   &lt;int&gt;  &lt;int&gt; &lt;int&gt;    &lt;int&gt;    &lt;int&gt;
##  1   0050   121799       21231  100568   2051   918    97599    18901
##  2   0051    86349       15302   71047   1314   438    69295    15926
##  3   0052    57124       12084   45040    786   436    43818    11943
##  4   0053   104365       20689   83676   1719   690    81267    18395
##  5   0054    35635        6336   29299    506   186    28607     7590
##  6   0055    76458       14717   61741   1313   550    59878    19641
##  7   0056  1000098      238264  761834  13718  5552   742564   155891
##  8   0057   146393       26366  120027   2584  1442   116001    20371
##  9   0059   367063       72659  294404   4947  1857   287600    87968
## 10   0060   434913       93470  341443   6785  2343   332315    80238
## # ... with 295 more rows, and 10 more variables: MÉLENCHON &lt;int&gt;,
## #   MACRON &lt;int&gt;, FILLON &lt;int&gt;, LASSALLE &lt;int&gt;, `DUPONT-AIGNAN` &lt;int&gt;,
## #   HAMON &lt;int&gt;, ASSELINEAU &lt;int&gt;, POUTOU &lt;int&gt;, ARTHAUD &lt;int&gt;,
## #   CHEMINADE &lt;int&gt;
```

---
## Exemple


```r
elections %&gt;% 
  group_by(ZE2010) %&gt;% 
  summarise_at(vars(Inscrits, Abstentions, Votants, Blancs, Nuls, Exprimés, `LE PEN`:CHEMINADE), funs(sum(.))) %&gt;% 
  mutate_at(vars(`LE PEN`:CHEMINADE), funs(. / Inscrits * 100))
```

```
## # A tibble: 305 x 18
##    ZE2010 Inscrits Abstentions Votants Blancs  Nuls Exprimés `LE PEN`
##     &lt;chr&gt;    &lt;int&gt;       &lt;int&gt;   &lt;int&gt;  &lt;int&gt; &lt;int&gt;    &lt;int&gt;    &lt;dbl&gt;
##  1   0050   121799       21231  100568   2051   918    97599 15.51819
##  2   0051    86349       15302   71047   1314   438    69295 18.44376
##  3   0052    57124       12084   45040    786   436    43818 20.90715
##  4   0053   104365       20689   83676   1719   690    81267 17.62564
##  5   0054    35635        6336   29299    506   186    28607 21.29928
##  6   0055    76458       14717   61741   1313   550    59878 25.68861
##  7   0056  1000098      238264  761834  13718  5552   742564 15.58757
##  8   0057   146393       26366  120027   2584  1442   116001 13.91528
##  9   0059   367063       72659  294404   4947  1857   287600 23.96537
## 10   0060   434913       93470  341443   6785  2343   332315 18.44921
## # ... with 295 more rows, and 10 more variables: MÉLENCHON &lt;dbl&gt;,
## #   MACRON &lt;dbl&gt;, FILLON &lt;dbl&gt;, LASSALLE &lt;dbl&gt;, `DUPONT-AIGNAN` &lt;dbl&gt;,
## #   HAMON &lt;dbl&gt;, ASSELINEAU &lt;dbl&gt;, POUTOU &lt;dbl&gt;, ARTHAUD &lt;dbl&gt;,
## #   CHEMINADE &lt;dbl&gt;
```

---
## Exemple


```r
library(sf)
```

```
## Linking to GEOS 3.5.1, GDAL 2.1.2, proj.4 4.9.3
```

```r
communesTM &lt;- st_read("./data/communesTM.geojson") # https://data.toulouse-metropole.fr/explore/dataset/communes/
```

```
## Reading layer `OGRGeoJSON' from data source `/media/Data/Dropbox/datactivi.st/AU Toulouse/Formation AUTA/data/communesTM.geojson' using driver `GeoJSON'
## Simple feature collection with 37 features and 6 fields
## geometry type:  POLYGON
## dimension:      XY
## bbox:           xmin: 1.20408 ymin: 43.51625 xmax: 1.631831 ymax: 43.76703
## epsg (SRID):    4326
## proj4string:    +proj=longlat +datum=WGS84 +no_defs
```

```r
elections %&gt;% 
  right_join(communesTM, by = c("CodeInsee" = "code_insee"))
```

```
## Warning: Column `CodeInsee`/`code_insee` joining character vector and
## factor, coercing into character vector
```

```
## # A tibble: 37 x 62
##    CodeInsee CodeDepartement   Département                  Commune
##        &lt;chr&gt;           &lt;chr&gt;         &lt;chr&gt;                    &lt;chr&gt;
##  1     31355              31 Haute-Garonne                     Mons
##  2     31003              31 Haute-Garonne             Aigrefeuille
##  3     31032              31 Haute-Garonne                 Aussonne
##  4     31445              31 Haute-Garonne        Quint-Fonsegrives
##  5     31467              31 Haute-Garonne              Saint-Alban
##  6     31022              31 Haute-Garonne               Aucamville
##  7     31150              31 Haute-Garonne             Cornebarrieu
##  8     31506              31 Haute-Garonne Saint-Orens-de-Gameville
##  9     31163              31 Haute-Garonne            Drémil-Lafage
## 10     31184              31 Haute-Garonne                 Flourens
## # ... with 27 more rows, and 58 more variables: Inscrits &lt;int&gt;,
## #   Abstentions &lt;int&gt;, Abstentions_ins &lt;dbl&gt;, Votants &lt;int&gt;,
## #   Votants_ins &lt;dbl&gt;, Blancs &lt;int&gt;, Blancs_ins &lt;dbl&gt;, Blancs_vot &lt;dbl&gt;,
## #   Nuls &lt;int&gt;, Nuls_ins &lt;dbl&gt;, Nuls_vot &lt;dbl&gt;, Exprimés &lt;int&gt;,
## #   Exprimés_ins &lt;dbl&gt;, Exprimés_vot &lt;dbl&gt;, `LE PEN` &lt;int&gt;,
## #   MÉLENCHON &lt;int&gt;, MACRON &lt;int&gt;, FILLON &lt;int&gt;, LASSALLE &lt;int&gt;,
## #   `DUPONT-AIGNAN` &lt;int&gt;, HAMON &lt;int&gt;, ASSELINEAU &lt;int&gt;, POUTOU &lt;int&gt;,
## #   ARTHAUD &lt;int&gt;, CHEMINADE &lt;int&gt;, `LE PEN_ins` &lt;dbl&gt;,
## #   MÉLENCHON_ins &lt;dbl&gt;, MACRON_ins &lt;dbl&gt;, FILLON_ins &lt;dbl&gt;,
## #   LASSALLE_ins &lt;dbl&gt;, `DUPONT-AIGNAN_ins` &lt;dbl&gt;, HAMON_ins &lt;dbl&gt;,
## #   ASSELINEAU_ins &lt;dbl&gt;, POUTOU_ins &lt;dbl&gt;, ARTHAUD_ins &lt;dbl&gt;,
## #   CHEMINADE_ins &lt;dbl&gt;, `LE PEN_exp` &lt;dbl&gt;, MÉLENCHON_exp &lt;dbl&gt;,
## #   MACRON_exp &lt;dbl&gt;, FILLON_exp &lt;dbl&gt;, LASSALLE_exp &lt;dbl&gt;,
## #   `DUPONT-AIGNAN_exp` &lt;dbl&gt;, HAMON_exp &lt;dbl&gt;, ASSELINEAU_exp &lt;dbl&gt;,
## #   POUTOU_exp &lt;dbl&gt;, ARTHAUD_exp &lt;dbl&gt;, CHEMINADE_exp &lt;dbl&gt;,
## #   LIBGEO &lt;chr&gt;, ZE2010 &lt;chr&gt;, LIBZE2010 &lt;chr&gt;, DEP &lt;chr&gt;, REG &lt;chr&gt;,
## #   cugt &lt;fctr&gt;, libcom &lt;fctr&gt;, libelle &lt;fctr&gt;, code_fantoir &lt;fctr&gt;,
## #   geo_point_2d &lt;list&gt;, geometry &lt;simple_feature&gt;
```


---
## À ne pas confondre : binding

Ici il s'agit de juxtaposer des jeux de données 

- `bind_rows`
- `bind_cols`

---
## Tips &amp; tricks dplyr


```r
ZE2010 %&gt;% 
  group_by(LIBZE2010) %&gt;% 
  summarise(n = n()) %&gt;% 
  arrange(desc(n))
```

```
## # A tibble: 321 x 2
##                LIBZE2010     n
##                    &lt;chr&gt; &lt;int&gt;
##  1              Toulouse   716
##  2                Amiens   478
##  3                 Rouen   473
##  4      Tarbes - Lourdes   451
##  5                Troyes   449
##  6                 Dijon   447
##  7              Besançon   420
##  8              Bordeaux   408
##  9                 Nancy   395
## 10 Roissy - Sud Picardie   393
## # ... with 311 more rows
```

---
## Tips &amp; tricks dplyr



```r
ZE2010 %&gt;% 
  count(LIBZE2010, sort = TRUE)
```

```
## # A tibble: 321 x 2
##                LIBZE2010     n
##                    &lt;chr&gt; &lt;int&gt;
##  1              Toulouse   716
##  2                Amiens   478
##  3                 Rouen   473
##  4      Tarbes - Lourdes   451
##  5                Troyes   449
##  6                 Dijon   447
##  7              Besançon   420
##  8              Bordeaux   408
##  9                 Nancy   395
## 10 Roissy - Sud Picardie   393
## # ... with 311 more rows
```

---
## Tips &amp; tricks dplyr

Numéroter les communes par ordre décroissant de vote Le Pen dans le département


```r
elections %&gt;% 
  group_by(CodeDepartement) %&gt;% 
  arrange(desc(`LE PEN_exp`)) %&gt;% 
  mutate(numero = 1:n()) %&gt;% 
  ungroup %&gt;% 
  arrange(desc(`LE PEN_exp`)) %&gt;% 
  select(CodeInsee, Commune, Département, numero, `LE PEN_exp`)
```

```
## # A tibble: 35,496 x 5
##    CodeInsee       Commune         Département numero `LE PEN_exp`
##        &lt;chr&gt;         &lt;chr&gt;               &lt;chr&gt;  &lt;int&gt;        &lt;dbl&gt;
##  1     52066       Brachay         Haute-Marne      1     83.72093
##  2     ZP051      Tatakoto Polynésie française      1     74.78261
##  3     10044  Bétignicourt                Aube      1     74.07407
##  4     02043       Bagneux               Aisne      1     72.22222
##  5     ZP041          Rapa Polynésie française      2     70.29703
##  6     52201 Flammerécourt         Haute-Marne      2     69.04762
##  7     88298     Ménarmont              Vosges      1     66.66667
##  8     ZP030        Napuka Polynésie française      3     66.66667
##  9     08184         Fromy            Ardennes      1     66.07143
## 10     25552       Sourans               Doubs      1     65.59140
## # ... with 35,486 more rows
```



---
class: center, middle, inverse
## Les tidydata géographiques: sf

---
## Simple features

- une architecture commune pour les *simple features geometries*
- un standard formel : OGC 06-103r4, ISO 19125
- le standard des outils libres de SIG
- un ensemble d'encodages :
  + WKB
  + WKT
  
---
## Simple features

[![](./img/classes.png)](http://www.opengeospatial.org/standards/sfa)

---
## Simple features

Représenter des éléments géographiques en plein texte (WKT) :

```
POINT(0 0)
LINESTRING(0 0,1 1,1 2)
POLYGON((0 0,4 0,4 4,0 4,0 0),(1 1, 2 1, 2 2, 1 2,1 1))
MULTIPOINT((0 0),(1 2))
MULTILINESTRING((0 0,1 1,1 2),(2 3,3 2,5 4))
MULTIPOLYGON(((0 0,4 0,4 4,0 4,0 0),(1 1,2 1,2 2,1 2,1 1)),
((-1 -1,-1 -2,-2 -2,-2 -1,-1 -1)))
GEOMETRYCOLLECTION(POINT(2 3),LINESTRING(2 3,3 4))
```

Peut exister en 2, 3, 4 dimensions. 

---
## Simple features

[![](./img/schema.png)](http://pebesma.staff.ifgi.de/pebesma_sfr.pdf)


---
## Simple features

- un dataframe
- une ligne par feature ("liste-colonne")
- géométries et attributs ont le même statut
- très similaire à la manière dont PostGIS fonctionne





```r
dbGetQuery(connection, "SELECT id, ST_AsText(geom) AS geometry from nodes LIMIT 10") 
```

```
##        id                    geometry
## 1  625219 POINT(1.4710213 43.5495882)
## 2  625226 POINT(1.4781246 43.5523568)
## 3  625235  POINT(1.471321 43.5542919)
## 4  625236 POINT(1.4722469 43.5554962)
## 5  625239 POINT(1.4700917 43.5545298)
## 6  625240  POINT(1.471471 43.5544525)
## 7  625241 POINT(1.4709202 43.5550524)
## 8  625242 POINT(1.4719338 43.5550721)
## 9  625255 POINT(1.4686231 43.5551804)
## 10 625262 POINT(1.4729169 43.5570509)
```


---
## Importer des données spatiales

[Source](https://data.toulouse-metropole.fr/explore/dataset/quartiers-de-democratie-locale0/export/?location=12,43.60074,1.43283&amp;basemap=jawg.streets)


```r
library(sf)
quartiers &lt;- st_read("./data/quartiers-de-democratie-locale0.shp") 
```

```
## Reading layer `quartiers-de-democratie-locale0' from data source `/media/Data/Dropbox/datactivi.st/AU Toulouse/Formation AUTA/data/quartiers-de-democratie-locale0.shp' using driver `ESRI Shapefile'
## Simple feature collection with 20 features and 5 fields
## geometry type:  POLYGON
## dimension:      XY
## bbox:           xmin: 1.350331 ymin: 43.5327 xmax: 1.515336 ymax: 43.6687
## epsg (SRID):    4326
## proj4string:    +proj=longlat +datum=WGS84 +no_defs
```

---
## Importer des données spatiales


```r
glimpse(quartiers)
```

```
## Observations: 20
## Variables: 6
## $ quartier    &lt;fctr&gt; 3.1, 3.3, 5.2, 5.3, 6.4, 4.2, 1.1, 2.3, 3.2, 6.3,...
## $ nom_quartie &lt;fctr&gt; Minimes / Barrière de Paris / Ponts-Jumeaux, Troi...
## $ maire_de_qu &lt;fctr&gt; Maxime Boyer, Françoise Roncato, Florie Lacroix, ...
## $ secteur     &lt;dbl&gt; 3, 3, 5, 5, 6, 4, 1, 2, 3, 6, 1, 2, 6, 6, 2, 2, 5,...
## $ nom_secteur &lt;fctr&gt; Toulouse Nord, Toulouse Nord, Toulouse Sud Est, T...
## $ geometry    &lt;simple_feature&gt; POLYGON ((1.42381141853539 ..., POLYGON...
```

---
## Importer des données spatiales





```r
library(mapview)
mapview(quartiers)
```

<div id="htmlwidget-5af719c98dfc65d843a2" style="width:100%;height:504px;" class="widgetframe html-widget"></div>
<script type="application/json" data-for="htmlwidget-5af719c98dfc65d843a2">{"x":{"url":"index_files/figure-html//widgets/widget_unnamed-chunk-29.html","options":{"xdomain":"*","allowfullscreen":false,"lazyload":false}},"evals":[],"jsHooks":[]}</script>


---
## Importer des données spatiales


```r
quartiers2 &lt;- st_read("./data/quartiers-de-democratie-locale0.geojson") 
```

```
## Reading layer `OGRGeoJSON' from data source `/media/Data/Dropbox/datactivi.st/AU Toulouse/Formation AUTA/data/quartiers-de-democratie-locale0.geojson' using driver `GeoJSON'
## Simple feature collection with 20 features and 6 fields
## geometry type:  POLYGON
## dimension:      XY
## bbox:           xmin: 1.350331 ymin: 43.5327 xmax: 1.515336 ymax: 43.6687
## epsg (SRID):    4326
## proj4string:    +proj=longlat +datum=WGS84 +no_defs
```

---
## Importer des données spatiales


```r
glimpse(quartiers2)
```

```
## Observations: 20
## Variables: 7
## $ quartier          &lt;fctr&gt; 3.1, 3.3, 5.2, 5.3, 6.4, 4.2, 1.1, 2.3, 3.2...
## $ secteur           &lt;int&gt; 3, 3, 5, 5, 6, 4, 1, 2, 3, 6, 1, 2, 6, 6, 2,...
## $ maire_de_quartier &lt;fctr&gt; Maxime Boyer, Françoise Roncato, Florie Lac...
## $ nom_quartier      &lt;fctr&gt; Minimes / Barrière de Paris / Ponts-Jumeaux...
## $ nom_secteur       &lt;fctr&gt; Toulouse Nord, Toulouse Nord, Toulouse Sud ...
## $ geo_point_2d      &lt;list&gt; [&lt;43.626866, 1.430922&gt;, &lt;43.640691, 1.45725...
## $ geometry          &lt;simple_feature&gt; POLYGON ((1.42381141853539 ..., P...
```

---
## Importer des données spatiales





```r
library(mapview)
mapview(quartiers2)
```

<div id="htmlwidget-f57658fb03d9a8ef0592" style="width:100%;height:400px;" class="widgetframe html-widget"></div>
<script type="application/json" data-for="htmlwidget-f57658fb03d9a8ef0592">{"x":{"url":"index_files/figure-html//widgets/widget_unnamed-chunk-34.html","options":{"xdomain":"*","allowfullscreen":false,"lazyload":false}},"evals":[],"jsHooks":[]}</script>


---
## Importer des données spatiales


```r
ways &lt;- st_read_db(conn = connection, table = "ways", EWKB = TRUE)
glimpse(ways)
```

```
## Observations: 321,138
## Variables: 8
## $ id           &lt;dbl&gt; 1863458, 2304962, 2304963, 2305016, 2305119, 2305...
## $ version      &lt;int&gt; 9, 18, 9, 19, 23, 12, 16, 21, 26, 17, 4, 26, 22, ...
## $ user_id      &lt;int&gt; 922338, 5744795, 94997, 5744795, 5733375, 5733375...
## $ tstamp       &lt;dttm&gt; 2017-08-22 13:09:10, 2017-05-08 19:47:35, 2012-1...
## $ changeset_id &lt;dbl&gt; 51336738, 48508488, 13351965, 48508488, 48144530,...
## $ tags         &lt;chr&gt; "\"name\"=&gt;\"Rue Julia\", \"oneway\"=&gt;\"no\", \"h...
## $ nodes        &lt;chr&gt; "{8010736,4840560425,8010738,4840560424,484056042...
## $ linestring   &lt;simple_feature&gt; LINESTRING (1.4844746 43.59..., LINEST...
```

---
## Importer des données spatiales


```r
ways %&gt;% 
  filter(stringr::str_detect(tags, "pedestrian")) %&gt;% 
  mapview()
```

<div id="htmlwidget-956b4423020c366f83d3" style="width:100%;height:400px;" class="widgetframe html-widget"></div>
<script type="application/json" data-for="htmlwidget-956b4423020c366f83d3">{"x":{"url":"index_files/figure-html//widgets/widget_unnamed-chunk-37.html","options":{"xdomain":"*","allowfullscreen":false,"lazyload":false}},"evals":[],"jsHooks":[]}</script>


---
## Importer des données spatiales 


```r
library(leaflet)
leaflet() %&gt;% addTiles() %&gt;% setView(-93.65, 42.0285, zoom = 4) %&gt;%
  addWMSTiles(
    "http://mesonet.agron.iastate.edu/cgi-bin/wms/nexrad/n0r.cgi",
    layers = "nexrad-n0r-900913",
    options = WMSTileOptions(format = "image/png", transparent = TRUE),
    attribution = "Weather data © 2012 IEM Nexrad"
  )
```

<div id="htmlwidget-14f381167a04cb45a1b5" style="width:100%;height:300px;" class="widgetframe html-widget"></div>
<script type="application/json" data-for="htmlwidget-14f381167a04cb45a1b5">{"x":{"url":"index_files/figure-html//widgets/widget_unnamed-chunk-39.html","options":{"xdomain":"*","allowfullscreen":false,"lazyload":false}},"evals":[],"jsHooks":[]}</script>

---
class: center, middle, inverse
## Analyse uni- et bi-variées

---
## Analyses univariées 

Plusieurs approches possibles. Quels sont vos besoins ?

Tidyverse =&gt; 


```r
df %&gt;% 
  group_by(mes_groupes) %&gt;% 
  summarise(mean = mean(ma_variable), median = median(ma_variable))

df %&gt;% 
  group_by(mes_groupes) %&gt;%
  summarise_at(vars(varA, varB, varC), funs(mean = mean(.), median = median(.), max = max(.), min = min(.)), sd = sd(.))
```

---
## Analyses bivariées (corrélations)


```r
library(corrr)
pres2017T1_communes %&gt;% 
  select(contains("_ins")) %&gt;% 
  correlate
```

```
## # A tibble: 16 x 17
##              rowname Abstentions_ins Votants_ins   Blancs_ins     Nuls_ins
##                &lt;chr&gt;           &lt;dbl&gt;       &lt;dbl&gt;        &lt;dbl&gt;        &lt;dbl&gt;
##  1   Abstentions_ins              NA -1.00000000 -0.059804330  0.020592416
##  2       Votants_ins     -1.00000000          NA  0.059804330 -0.020592416
##  3        Blancs_ins     -0.05980433  0.05980433           NA -0.092379854
##  4          Nuls_ins      0.02059242 -0.02059242 -0.092379854           NA
##  5      Exprimés_ins     -0.97615193  0.97615193 -0.111598086 -0.138615827
##  6        LE PEN_ins     -0.16415127  0.16415127 -0.025287327 -0.045097069
##  7     MÉLENCHON_ins     -0.14147164  0.14147164 -0.005254065 -0.004763823
##  8        MACRON_ins     -0.29423578  0.29423578 -0.026513489 -0.030484641
##  9        FILLON_ins     -0.24315424  0.24315424 -0.069984245 -0.063847412
## 10      LASSALLE_ins     -0.01433997  0.01433997  0.006242679  0.035552260
## 11 DUPONT-AIGNAN_ins     -0.24141426  0.24141426  0.026807254 -0.025359341
## 12         HAMON_ins     -0.11277243  0.11277243 -0.000472832  0.009515770
## 13    ASSELINEAU_ins     -0.02968179  0.02968179 -0.005877817 -0.008148521
## 14        POUTOU_ins     -0.03355283  0.03355283  0.035173397  0.025512401
## 15       ARTHAUD_ins     -0.02709057  0.02709057  0.032341708  0.030567649
## 16     CHEMINADE_ins     -0.03116503  0.03116503  0.002807641  0.010563846
## # ... with 12 more variables: Exprimés_ins &lt;dbl&gt;, `LE PEN_ins` &lt;dbl&gt;,
## #   MÉLENCHON_ins &lt;dbl&gt;, MACRON_ins &lt;dbl&gt;, FILLON_ins &lt;dbl&gt;,
## #   LASSALLE_ins &lt;dbl&gt;, `DUPONT-AIGNAN_ins` &lt;dbl&gt;, HAMON_ins &lt;dbl&gt;,
## #   ASSELINEAU_ins &lt;dbl&gt;, POUTOU_ins &lt;dbl&gt;, ARTHAUD_ins &lt;dbl&gt;,
## #   CHEMINADE_ins &lt;dbl&gt;
```

---
## Analyses bivariées (corrélations)


```r
pres2017T1_communes %&gt;% 
  select(contains("_ins")) %&gt;% 
  correlate %&gt;% 
  focus(FILLON_ins, `LE PEN_ins`, MACRON_ins, MÉLENCHON_ins, mirror = TRUE) %&gt;% 
  rearrange(method = "HC", absolute = FALSE) %&gt;%  # trier par corrélation
  shave() %&gt;% 
  fashion()
```

```
##         rowname FILLON_ins MACRON_ins LE.PEN_ins MÉLENCHON_ins
## 1    LE PEN_ins       -.13                                    
## 2    MACRON_ins       -.08                                    
## 3 MÉLENCHON_ins       -.48        .11       -.34              
## 4    FILLON_ins                  -.08       -.13          -.48
```

---
## Analyses bivariées (corrélations)


```r
pres2017T1_communes %&gt;% 
  select(contains("_ins")) %&gt;% 
  correlate %&gt;% 
  rearrange(method = "HC", absolute = FALSE) %&gt;%  # trier par corrélation
  shave() %&gt;% 
  rplot()
```

![](index_files/figure-html/unnamed-chunk-43-1.png)&lt;!-- --&gt;

---
## Analyse multivariée (AGD)

Le package à utiliser : [`FactoMineR`](http://factominer.free.fr/) - français, assez bien documenté


```r
library(FactoMineR)

acp &lt;- pres2017T1_communes %&gt;% 
  select(contains("_ins"), "Département") %&gt;% 
  PCA(quali.sup = 17, graph = FALSE)

acp
```

```
## **Results for the Principal Component Analysis (PCA)**
## The analysis was performed on 35496 individuals, described by 17 variables
## *The results are available in the following objects:
## 
##    name               
## 1  "$eig"             
## 2  "$var"             
## 3  "$var$coord"       
## 4  "$var$cor"         
## 5  "$var$cos2"        
## 6  "$var$contrib"     
## 7  "$ind"             
## 8  "$ind$coord"       
## 9  "$ind$cos2"        
## 10 "$ind$contrib"     
## 11 "$quali.sup"       
## 12 "$quali.sup$coord" 
## 13 "$quali.sup$v.test"
## 14 "$call"            
## 15 "$call$centre"     
## 16 "$call$ecart.type" 
## 17 "$call$row.w"      
## 18 "$call$col.w"      
##    description                                          
## 1  "eigenvalues"                                        
## 2  "results for the variables"                          
## 3  "coord. for the variables"                           
## 4  "correlations variables - dimensions"                
## 5  "cos2 for the variables"                             
## 6  "contributions of the variables"                     
## 7  "results for the individuals"                        
## 8  "coord. for the individuals"                         
## 9  "cos2 for the individuals"                           
## 10 "contributions of the individuals"                   
## 11 "results for the supplementary categorical variables"
## 12 "coord. for the supplementary categories"            
## 13 "v-test of the supplementary categories"             
## 14 "summary statistics"                                 
## 15 "mean of the variables"                              
## 16 "standard error of the variables"                    
## 17 "weights for the individuals"                        
## 18 "weights for the variables"
```

---
## Analyse multivariée (AGD)


```r
library(explor)
explor(acp)
```

---
class: inverse, center, middle

## Evaluation

Merci de remplir l'évaluation : https://frama.link/auat_eval_2

---
class: center, middle, title
background-image: url(./img/FraMauroDetailedMap.jpg)
background-size: cover
background-position: 50% 50%
# Réaliser des cartes statistiques
## R : le couteau suisse des données

&lt;/BR&gt;
&lt;/BR&gt;
&lt;/BR&gt;

###  Joël Gombin, avec Endi Pons
&lt;img src="./img/Logo_DATACTIVIST_TW.png" height="100px" /&gt;

.right[.footnote[&lt;a href='https://commons.wikimedia.org/wiki/File:FraMauroDetailedMap.jpg'&gt;source&lt;/a&gt;]]

---
## Objectifs (jour 3)

- Solidifier les acquis des deux jours précédents

- Panorama de la cartographie et du SIG dans R

- Utiliser les packages tmap et cartography pour réaliser des cartes statistiques « print »

- Utiliser les packages mapview et leaflet pour réaliser des cartes statistiques « web »

- Automatiser un workflow cartographique

---
## Exercices

Un moment pour mettre en pratique et tester ce qui a été appris avant-hier et hier (tidyverse, AGD...)

---
## Panorama de la cartographie et du SIG dans R 

- un workflow intégré

- un workflow reproductible

- une convergence des paradigmes de carto "statique" (print) et "dynamique" (web)

- l'intégration dans des apps : http://shiny.rstudio.com/gallery/superzip-example.html, https://gallery.shinyapps.io/shiny-salesman/ 

---
## Panorama de la cartographie et du SIG dans R 

- des capacités de base grâce à `sf::plot` (mais limitées) 

- des capacités SIG grâce à `sf` via GEOS ([fonctions `st_*`](https://r-spatial.github.io/sf/articles/sf3.html#geometrical-operations) similaires à PostGIS)

- des packages de cartographie de haut niveau : `cartography` et `tmap` - mais aussi `ggplot2` ([version de développement](http://ggplot2.tidyverse.org/news/index.html#ggplot2-2-2-1-9000))

- des packages de cartographie interactive/web : `leaflet`, `mapview` and friends ([`mapedit`](https://github.com/r-spatial/mapedit)...)

---
class: inverse, center, middle
# Notions de cartographie 


---
## Qu'est-ce qu'une carte ? 

"Une carte est une représentation géométrique plane simplifiée et conventionnelle de tout ou partie de la surface terrestre, et cela dans un rapport de similitude convenable qu'on appelle échelle." (F. Joly, 1976)


Référence : [Béguin et Pumain, 2014 (3e éd.)](http://www.persee.fr/web/revues/home/prescript/article/espos_0755-7809_1998_num_16_1_1827_t1_0119_0000_2)

---
## La notion de projection 

La projection est l'outil mathématique qui permet de passer du géoïde représentant la Terre à une représentation plane. 

Projections conformes (Mercator, Lambert) ou équivalentes (Eckert IV, Gall). Il y a toujours une déformation !

Les coordonnées géographiques sont exprimées en longitude et latitude. Les unités peuvent être des degrés ou des grades. La projection transforme les coordonnées géographiques en coordonnées x/y. 

---
## La notion de projection 

Exemple de coordonnées géographiques :

![largeur](./img/gmaps.png)

---
## La notion de projection 

Un truc cool pour jouer avec les différentes projections :

http://bl.ocks.org/mbostock/raw/3711652/

---
## La notion de projection 

_The West Wing_, la série qui arrive à faire un sketch drôle sur les projections géographiques :

&lt;iframe width="560" height="315" src="https://www.youtube.com/embed/vVX-PrBRtTY" frameborder="0" allowfullscreen&gt;&lt;/iframe&gt;

---
## L'échelle 

L'échelle d'une carte représente le rapport d'une distance mesurée sur la carte à sa valeur réelle sur le terrain.

Échelle        | 1 cm représente
---------------|----------------
1/10000        |100 m
1/25000        |250m
1/50000        |500m
1/100000       |1km
1/1000000      |10km


---
## L'échelle 

Attention : "petite échelle" = grande superficie représentée
"grande échelle" = petite superficie représentée

L'échelle est déformée à distance du centre de projection (équateur pour Mercator)

Échelle numérique et échelle graphique

---
class: center, middle

![largeur](./img/carteParis1.png)

---
## La généralisation 

"L'opération qui par sélection, schématisation et harmonisation reconstitue sur une carte la réalité de la surface représentée dans ses traits essentiels en fonction du but de la carte, de son thème, de son échelle et des particularités de la région cartographiée."

---
## La sélection 

Quelles couches d'information représenter ? Ni trop (surcharge d'information, à la Google Maps) ni trop peu (rendre la carte intelligible au lecteur).

Le [style "toner"](http://maps.stamen.com/toner/#12/37.7706/-122.3782) peut être utile pour trouver cet équilibre, en cartographie thématique :

---
class: center, middle

![largeur](./img/carteParis1.png)

---
## La schématisation 

Opération de simplification, qui peut être structurale (tracés) ou conceptuelle (schéma). 

Attention : on peut simplifier à partir de données détaillées, mais on ne peut pas faire l'inverse ! Donc toujours veiller à conserver les données dans leur forme la plus détaillée. 


---
## Le fond de carte 

Le fond de carte est constitué des éléments repris d'une carte topographique (par exemple de l'IGN) et utilisés pour une carte thématique.

"Carte reproduite totalement ou partiellement, en une ou plusieurs couleurs souvent atténuées, servant de repère pour le report en surcharge de phénomènes localisables déterminés" (CFC). Peut concerner les découpages administratifs, le réseau routier, hydrographique, les courbes de niveau, etc. 


---
## Les sources de fonds de carte 

Traditionnellement, en France : l'IGN.

De plus en plus : Google Maps, Open Street Map, Stamen...

---
class: center, middle

http://maps.stamen.com/toner/#12/48.8974/2.2017

http://maps.stamen.com/watercolor/#12/48.8974/2.2017

---
## Vecteur ou raster 

Comment stocker et représenter l'information géographique ?

- "Mode raster" : il s'agit d'une image, découpée en pixels. Des valeurs sont attribués aux pixels. Ex : photo satellite.
- "Mode vecteur" : on utilise des objets géométriques (lignes, points, polygones...) auxquels sont associés des attributs. Ex : carte d'un réseau de transports.

---
class: center, middle

&lt;iframe width="800" height="600" frameborder="0" scrolling="no" marginheight="0" marginwidth="0" src="https://www.openstreetmap.org/export/embed.html?bbox=2.3314136266708374%2C48.866987337550164%2C2.33908474445343%2C48.87019135286425&amp;amp;layer=transportmap" style="border: 1px solid black"&gt;&lt;/iframe&gt;

---
class: center, middle

[FrancePixels](http://www.comeetie.fr/galerie/francepixels/)

---
## Cartes choroplèthes 

Une carte choroplèthe est une carte thématique où les régions sont colorées ou remplies d'un motif qui montre une mesure statistique, tels la densité de population ou le revenu par habitant. Ce type de carte facilite la comparaison d'une mesure statistique d'une région à l'autre ou montre la variabilité de celle-ci pour une région donnée.

---
## Cartes en anamorphose ou cartogramme 

"La cartographie en anamorphose a pour but d'adapter la forme de la carte non pas à la réalité physique mais plutôt à la réalité perçue." [(Langlois et Denain, 1996)](http://cybergeo.revues.org/129) 

On déforme le fond de carte en fonction d'une variable quantitative (voire arbitrairement).

---
class: center, middle

[![largeur](./img/carte2.png)](http://www.slate.fr/france/87669/cartes-europeennes-2014)

---
## Le langage cartographique 

[Bertin, 1965](http://classiques.uqac.ca/collection_methodologie/bertin_jacques/representations_visuelles_info/representations_visuelles_info_texte.html) : travail sur la sémiologie graphique. La carte, comme le graphique, permettent de percevoir *en même temps* trois informations (X,Y,Z).

Mais pour que cette communication soit efficace, il faut respecter un langage précis et ses règles. 

Assez comparable à la grammaire des graphiques.

---
## Les composantes du langage cartographique 

- les signes graphiques élémentaires : point, trait, tâche (aplat). 
- le figuré cartographique : combinaison de signes graphiques élémentaires.
- l'implantation graphique : manière d'appliquer le figuré sur la carte (ponctuelle, linéaire ou zonale).
- les variables visuelles : façon de faire varier les signes graphiques. Il y en a sept.

---
## Les variables visuelles 

- forme
- taille
- couleur 
- valeur 
- orientation
- texture-structure (trame)
- grain

---
## La forme 

- Ne transcrit qu'une information qualitative. 
- Veiller à ne pas utiliser trop de formes différentes, sinon cela devient illisible (&lt; 10)
- Utilisée dans les trois types d'implantation graphique. En implantation zonale =&gt; texture.

---
## La taille 

- longueur/hauteur/surface/volume
- bonne perception visuelle par l'œil
- rapport de proportionnalité entre information quantitative représentée et la forme
- attention à respecter cette proportionnalité ! 
- la taille est plus facile à estimer que la surface ou le volume

Un exemple d'utilisation incorrecte (non-proportionnelle) de la taille :

---
## La taille 

![largeur](./img/UneMonde.png)

---
## La taille 

- Le cartogramme (anamorphose) comme cas particulier de l'utilisation de la taille.
- [Créer un fonds de carte en anamorphose](http://scapetoad.choros.ch/)
- [Réaliser un cartogramme en javascript](http://prag.ma/code/d3-cartogram/)

---
## La couleur 

* fort pouvoir différentiel
* esthétique
* trois propriétés :
    + ton 
    + saturation
    + intensité
  
---
## La couleur

http://hslpicker.com/

---
## La couleur

- En général, on utilise un seul ton et on joue sur l'intensité.

&lt;iframe src='./img/grenobleAbstention.html' width='600px' height='500px' style="border:none;"&gt;&lt;/iframe&gt;

---
## La couleur

- Parfois, par exemple pour représenter une variation, on peut jouer sur deux échelles de tons

&lt;iframe src='./img/amiensProgFN.html' width='600px' height='500px' style="border:none;"&gt;&lt;/iframe&gt;

---
## La couleur

- Si on représente une variable qualitative, on utilise autant de tons que de catégories

&lt;iframe src='./img/comm.couleur.html' width='500px' height='400px' style="border:none;"&gt;&lt;/iframe&gt;

---
## La couleur 

- Penser aux daltoniens !
- Penser au support (web, papier...)
- Des palettes de couleur de référence : [colorbrewer2.org](http://colorbrewer2.org/) par exemple
- Un autre outil de construction de palette de couleur : [vis4.net/labs/multihue](https://vis4.net/labs/multihue/)
- C'est la variable qu'on utilise le plus en cartographie thématique.

---
## La valeur 

- Valeur : rapport entre quantités totales de noir et de blanc perçues dans une surface donnée (cf. aussi "gris typographique"). 
- Peut passer par une trame 
- Peut concerner une couleur (un ton)
- En général, on utilise des classes (max 6/7)
- Mais parfois, coloration continue

---
## La valeur 

Un exemple de coloration continue :

![largeur](./img/continue.jpg)

---

Des cartes _old school_ de densité, qui utilisent une trame :

![largeur](./img/densite.jpg)

---

Une autre coloration continue (pas très lisible parce qu'elle utilise trop de teintes [hues]) :

![largeur](./img/Purple-USA.jpg)

---
## Le grain 

- agrandissement ou réduction d'une texture/structure
- pas très utilisé, car mal perçu par l'œil humain

---
## L'orientation 

- Angle d'un figuré linéaire
- Pour variable qualitative, moins utilisé aujourd'hui

---
## L'orientation 

Un exemple d'utilisation par Todd et Le Bras :

![largeur](./img/lebrastodd.jpg)

---
## Distribution et découpage en classes des variables quantitatives 

- discrétisation : découper une variable continue en classes
- ce découpage n'est pas neutre, et ne peut être décidé indépendamment de la distribution de la variable représentée

---
## Distribution et découpage en classes des variables quantitatives 

Voir [cet article](http://www.persee.fr/web/revues/home/prescript/article/espos_0755-7809_2000_num_18_1_1930)

Un [moyen sympa](http://franceo3.geoclip.fr/index.php?profil=FV#z=-349737,6562730,1033057,513716;l=fr;i=euro14.pt_lfn;v=map12) de jouer avec les différentes méthodes de discrétisation.
    </textarea>
<script src="libs/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {window.dispatchEvent(new Event('resize'));});
(function() {var d = document, s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler"); if (!r) return; s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }"; d.head.appendChild(s);})();</script>

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  tex2jax: {
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre']
  }
});
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
